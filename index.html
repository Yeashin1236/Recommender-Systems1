<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two-Tower Movie Recommender (TF.js, MovieLens 100K)</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.x/dist/tf.min.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 1200px; margin: auto; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        button { padding: 10px 20px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
        .panel { flex: 1 1 45%; min-width: 400px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        canvas { border: 1px solid #ccc; display: block; margin-top: 10px; width: 100%; height: 300px; }
        #results-container { margin-top: 30px; }
        #results-container table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #results-container th, #results-container td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #results-container th { background-color: #eef; }
        .instructions { background-color: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; margin-top: 20px; color: #856404; }
    </style>
</head>
<body>
    <h1>ðŸŽ¬ Two-Tower Movie Recommender (Client-Side TF.js)</h1>
    <p>MovieLens 100K Dataset: Retrieval Model Demo</p>

    <div id="controls">
        <button id="load-data-btn">1. Load Data</button>
        <button id="train-btn" disabled>2. Train Model</button>
        <button id="test-btn" disabled>3. Test Recommendations</button>
    </div>

    <p id="status-log">Status: Awaiting action...</p>

    <div class="container">
        <div class="panel">
            <h2>Training Loss</h2>
            <p>Live loss chart (In-batch sampled softmax)</p>
            <canvas id="loss-chart" width="800" height="300"></canvas>
        </div>
        <div class="panel">
            <h2>Item Embedding Projection (PCA)</h2>
            <p>2D projection of a sample of item embeddings after training.</p>
            <canvas id="projection-chart" width="800" height="300"></canvas>
        </div>
    </div>

    <div id="results-container">
        <h2>Recommendation Results</h2>
        <p>A random user's historical top-10 vs. the model's top-10 recommendations (excluding rated items).</p>
    </div>

    <div class="instructions">
        <strong>Usability Tips:</strong>
        <ul>
            <li>Ensure `data/u.data` and `data/u.item` are accessible relative to this file.</li>
            <li>Training (`epochs=10`, `batchSize=512`) might take 1-3 minutes depending on your CPU. The loss chart updates live.</li>
            <li>To host this statically (e.g., on GitHub Pages), place the files in a repository structure: `/index.html`, `/app.js`, `/two-tower.js`, and `/data/u.data`, `/data/u.item`.</li>
        </ul>
    </div>

    <script src="two-tower.js"></script>
    <script src="app.js"></script>
</body>
</html>
